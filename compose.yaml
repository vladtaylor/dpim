services:
  speed-probe:
    # Use 'build: .' to tell Docker Compose to build the image from the local Dockerfile
    build: .
    
    # Give the container a friendly, unique name
    container_name: dpi-monitor-probe
    
    # Restart the container automatically if it stops (unless explicitly stopped by user)
    restart: unless-stopped
    
    # Note: Docker Compose will automatically look for a file named .env
    # in the same directory and load these variables into the container environment.

    environment:
      # --- INFLUXDB V1.x AUTHENTICATION (Database Name, User, Pass) ---
      - INFLUX_HOST=${INFLUX_HOST}
      - INFLUX_BUCKET=${INFLUX_BUCKET}
      - INFLUX_USER=${INFLUX_USER}
      - INFLUX_PASS=${INFLUX_PASS}

      # --- DEVICE IDENTIFIER ---
      - HOST_TAG=${HOST_TAG}

      # --- DEBUG/TEST CONFIG ---
      - DEBUG_MODE=${DEBUG_MODE}
      
      # --- IPERF CONFIG (Optional - Defaults are 10s duration, 4 parallel streams) ---
      - TEST_DURATION=${TEST_DURATION}
      - PARALLEL_STREAMS=${PARALLEL_STREAMS}
