services:
  speed-probe:
    # Use 'build: .' to tell Docker Compose to build the image from the local Dockerfile
    # This is necessary since we haven't pushed the image to a registry yet.
    build: .
    
    # Give the container a friendly, unique name
    container_name: dpi-monitor-probe
    
    # Restart the container automatically if it stops (unless explicitly stopped by user)
    restart: unless-stopped
    
    # Set the entrypoint to the log file so you can easily see the cron output
    # The cron job itself is started by the entrypoint.sh script.

    environment:
      # --- INFLUXDB V1.x AUTHENTICATION (Database Name, User, Pass) ---
      # **REQUIRED:** Replace these placeholders with your actual values
      - INFLUX_HOST=http://192.168.0.161:8086
      - INFLUX_BUCKET=<YOUR_DATABASE_NAME>
      - INFLUX_USER=<YOUR_USERNAME>
      - INFLUX_PASS=<YOUR_PASSWORD>

      # --- DEVICE IDENTIFIER ---
      # **REQUIRED:** Use a unique tag for this specific device (e.g., 'pi-kitchen', 'main-server')
      - HOST_TAG=<UNIQUE_DEVICE_NAME>

      # --- DEBUG/TEST CONFIG ---
      # Set to 'true' to skip the iperf test and push static data (500.5 Mbps) for testing DB connection.
      - DEBUG_MODE=false
      
      # --- IPERF CONFIG (Optional - Defaults are 10s duration, 4 parallel streams) ---
      # - TEST_DURATION=15
      # - PARALLEL_STREAMS=8
